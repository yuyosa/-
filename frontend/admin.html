<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Farm Game</title>
</head>
<body>
  <h1>Admin Panel</h1>
  <button onclick="loadUsers()">Refresh User List</button>
  <div id="user-list"></div>

<script>
  const API_BASE = "http://127.0.0.1:8000";

  async function loadUsers() {
    const resp = await fetch(`${API_BASE}/admin/users`);
    const users = await resp.json();
    const container = document.getElementById('user-list');
    container.innerHTML = '';

    users.forEach(user => {
      const userDiv = document.createElement('div');
      userDiv.style.border = "1px solid #ccc";
      userDiv.style.margin = "10px";
      userDiv.style.padding = "10px";

      userDiv.innerHTML = `<strong>${user.username}</strong> (ID: ${user.id}) - 密码: ${user.password} - 黄金: ${user.gold}<br>`;

      // 修改金币输入框
      const goldInput = document.createElement('input');
      goldInput.type = "number";
      goldInput.value = user.gold;
      goldInput.style.marginRight = "10px";

      const updateBtn = document.createElement('button');
      updateBtn.textContent = "Update Gold";
      updateBtn.onclick = () => updateGold(user.id, goldInput.value);

      // 删除按钮
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = "Delete User";
      deleteBtn.style.marginLeft = "10px";
      deleteBtn.onclick = () => deleteUser(user.id);

      userDiv.appendChild(goldInput);
      userDiv.appendChild(updateBtn);
      userDiv.appendChild(deleteBtn);

      const plotsList = document.createElement('ul');
      user.plots.forEach(plot => {
        const li = document.createElement('li');
        if (plot.crop) {
          li.textContent = `Plot ${plot.id}: ${plot.crop} (Planted at: ${plot.planted_at})`;
        } else {
          li.textContent = `Plot ${plot.id}: empty`;
        }
        plotsList.appendChild(li);
      });
      userDiv.appendChild(plotsList);
      container.appendChild(userDiv);
    });
  }

  async function updateGold(userId, gold) {
    const resp = await fetch(`${API_BASE}/admin/update_gold?user_id=${userId}&gold=${gold}`, { method: 'POST' });
    const data = await resp.json();
    alert(data.message || data.error);
    loadUsers();
  }

  async function deleteUser(userId) {
    if (!confirm("Are you sure you want to delete this user?")) return;
    const resp = await fetch(`${API_BASE}/admin/delete_user?user_id=${userId}`, { method: 'DELETE' });
    const data = await resp.json();
    alert(data.message || data.error);
    loadUsers();
  }
</script>
</body>
</html>
